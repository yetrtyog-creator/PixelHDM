[pytest]
# =============================================================================
# Pytest Configuration for PixelHDM-RPEA-DinoV3
# =============================================================================

# Default options for FAST development mode (excludes slow tests)
# To run all tests: pytest -m ""
# To run only slow tests: pytest -m slow
addopts =
    -m "not slow"
    --tb=short
    -q
    --disable-warnings

# Custom markers
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks integration/E2E tests
    gpu: marks tests requiring GPU/CUDA
    regression: marks regression tests for historical bugs
    parametrized: marks parametrized tests with multiple variants

# Timeout per test (seconds) - prevents hanging tests
timeout = 60

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Minimum version
minversion = 7.0

# =============================================================================
# Parallel Execution (requires pytest-xdist)
# =============================================================================
# Install: pip install pytest-xdist
# Usage:
#   pytest -n auto          # Auto-detect CPU cores
#   pytest -n 4             # Use 4 workers
#   pytest -n auto -m slow  # Parallel slow tests only

# =============================================================================
# Test Profiles (run with different commands)
# =============================================================================
#
# FAST (default, ~30-60s):
#   pytest
#   - Excludes: slow tests (model/, blocks/, strict/, training convergence)
#   - Use for: Development iteration
#
# FULL (~5-10min):
#   pytest -m ""
#   - Runs all 1700+ tests
#   - Use for: Pre-commit, CI
#
# PARALLEL FULL (~1-2min with 8 cores):
#   pytest -m "" -n auto
#   - Requires: pip install pytest-xdist
#   - Use for: CI with multiple cores
#
# STRICT ONLY (~2-3min):
#   pytest -m slow tests/strict/
#   - Architecture verification
#   - Use for: Design validation
#
# GPU TESTS:
#   pytest -m gpu
#   - CUDA-dependent tests
#   - Use for: GPU validation
